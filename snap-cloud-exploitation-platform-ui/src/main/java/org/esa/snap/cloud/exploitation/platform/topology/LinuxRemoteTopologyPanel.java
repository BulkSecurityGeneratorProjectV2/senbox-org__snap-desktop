package org.esa.snap.cloud.exploitation.platform.topology;

import org.esa.snap.cloud.exploitation.platform.loading.SwingUtils;

import javax.swing.*;
import java.awt.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.io.File;

public class LinuxRemoteTopologyPanel extends RemoteTopologyPanel {

    private final JTextField localSharedFolderPathTextField;
    private final JPasswordField localPasswordTextField;

    public LinuxRemoteTopologyPanel(Window parentWindow, Insets defaultTextFieldMargins, Insets defaultListItemMargins) {
        super(parentWindow, defaultTextFieldMargins, defaultListItemMargins);

        this.localSharedFolderPathTextField = new JTextField();
        this.localSharedFolderPathTextField.setMargin(defaultTextFieldMargins);

        this.localPasswordTextField = new JPasswordField();
        this.localPasswordTextField.setMargin(defaultTextFieldMargins);
    }

    @Override
    public void setSharedComponentsEnabled(boolean enabled) {
        super.setSharedComponentsEnabled(enabled);

        this.localSharedFolderPathTextField.setEnabled(enabled);
        this.localPasswordTextField.setEnabled(enabled);
    }

    @Override
    public JPasswordField getLocalPasswordTextField() {
        return this.localPasswordTextField;
    }

    @Override
    public void setRemoteTopology(RemoteTopology remoteTopology) {
        super.setRemoteTopology(remoteTopology);

        this.localSharedFolderPathTextField.setText(remoteTopology.getLocalSharedFolderPath());
        this.localPasswordTextField.setText(remoteTopology.getLocalPassword());
    }

    @Override
    public JTextField getLocalSharedFolderPathTextField() {
        return this.localSharedFolderPathTextField;
    }

    public void addComponents(int gapBetweenColumns, int gapBetweenRows, boolean addToolbarButtons, boolean addSharedFolderBrowseButton) {
        addSharedFolderURLRow(0, gapBetweenColumns, 0,false);
        addUsernameRow(1, gapBetweenColumns, gapBetweenRows);
        addPasswordRow(2, gapBetweenColumns, gapBetweenRows);
        addLocalSharedFolderRow(3, gapBetweenColumns, gapBetweenRows, addSharedFolderBrowseButton);
        addLocalPasswordRow(4, gapBetweenColumns, gapBetweenRows);
        addRemoteMachinesRow(5, gapBetweenColumns, gapBetweenRows, addToolbarButtons);
    }

    protected void addLocalPasswordRow(int rowIndex, int gapBetweenColumns, int gapBetweenRows) {
        GridBagConstraints c = SwingUtils.buildConstraints(0, rowIndex, GridBagConstraints.NONE, GridBagConstraints.WEST, 1, 1, gapBetweenRows, 0);
        add(new JLabel("Local password"), c);
        c = SwingUtils.buildConstraints(1, rowIndex, GridBagConstraints.HORIZONTAL, GridBagConstraints.WEST, 2, 1, gapBetweenRows, gapBetweenColumns);
        add(this.localPasswordTextField, c);
    }

    private void addLocalSharedFolderRow(int rowIndex, int gapBetweenColumns, int gapBetweenRows, boolean browseButtonVisible) {
        int columnSpan = (browseButtonVisible) ? 1 : 2;

        GridBagConstraints c = SwingUtils.buildConstraints(0, rowIndex, GridBagConstraints.NONE, GridBagConstraints.WEST, 1, 1, gapBetweenRows, 0);
        add(new JLabel("Local shared folder"), c);
        c = SwingUtils.buildConstraints(1, rowIndex, GridBagConstraints.HORIZONTAL, GridBagConstraints.WEST, columnSpan, 1, gapBetweenRows, gapBetweenColumns);
        add(this.localSharedFolderPathTextField, c);

        if (browseButtonVisible) {
            ActionListener browseSharedFolderButtonListener = new ActionListener() {
                @Override
                public void actionPerformed(ActionEvent event) {
                    File selectedFolder = selectSharedFolder();
                    if (selectedFolder != null) {
                        localSharedFolderPathTextField.setText(selectedFolder.getAbsolutePath());
                    }
                }
            };
            JButton browseButton = SwingUtils.buildBrowseButton(browseSharedFolderButtonListener, getTextFieldPreferredHeight());
            c = SwingUtils.buildConstraints(2, rowIndex, GridBagConstraints.NONE, GridBagConstraints.WEST, 1, 1, gapBetweenRows, gapBetweenColumns);
            add(browseButton, c);
        }
    }
}
