package org.esa.snap.cloud.exploitation.platform.topology;

import org.esa.snap.cloud.exploitation.platform.loading.AbstractTimerRunnable;
import org.esa.snap.cloud.exploitation.platform.loading.ILoadingIndicator;
import org.esa.snap.cloud.exploitation.platform.loading.IMessageDialog;

/**
 * Created by jcoravu on 19/12/2018.
 */
public class WriteServerCredentialsTimerRunnable extends AbstractTimerRunnable<Void> {

    private final IMessageDialog parentWindow;
    private final RemoteTopology remoteTopology;

    public WriteServerCredentialsTimerRunnable(IMessageDialog parentWindow, ILoadingIndicator loadingIndicator, int threadId, RemoteTopology remoteTopology) {
        super(loadingIndicator, threadId, 500);

        this.parentWindow = parentWindow;
        this.remoteTopology = remoteTopology;
    }

    @Override
    protected final void onTimerWakeUp(String messageToDisplay) {
        super.onTimerWakeUp("Saving...");
    }

    @Override
    protected final Void execute() throws Exception {
        RemoteTopologyUtils.writeTopology(this.remoteTopology);
        return null; // nothing to return
    }

    @Override
    protected void onSuccessfullyFinish(Void result) {
        this.parentWindow.close(); // close the dialog
    }

    @Override
    protected String getExceptionLoggingMessage() {
        return "Failed to write the remote topology into the file.";
    }

    @Override
    protected void onFailed(Exception exception) {
        this.parentWindow.showErrorDialog("Failed to write the remote topology into the file.", "Failed");
    }
}
