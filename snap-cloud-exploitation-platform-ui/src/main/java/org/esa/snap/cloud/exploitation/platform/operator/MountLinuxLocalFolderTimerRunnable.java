package org.esa.snap.cloud.exploitation.platform.operator;

import org.esa.snap.cloud.exploitation.platform.CloudExploitationPlatformOp;
import org.esa.snap.cloud.exploitation.platform.UnixMountLocalFolderResult;
import org.esa.snap.cloud.exploitation.platform.topology.IMountLocalSharedFolderCallback;
import org.esa.snap.cloud.exploitation.platform.topology.LinuxLocalSharedDrive;
import org.esa.snap.ui.loading.ILoadingIndicator;
import org.esa.snap.ui.loading.IMessageDialog;

public class MountLinuxLocalFolderTimerRunnable extends MountMacLocalFolderTimerRunnable {

    public MountLinuxLocalFolderTimerRunnable(IMessageDialog parentWindow, ILoadingIndicator loadingIndicator, int threadId,
                                              LinuxLocalSharedDrive linuxLocalSharedDrive, IMountLocalSharedFolderCallback callback) {

        super(parentWindow, loadingIndicator, threadId, linuxLocalSharedDrive, callback);
    }

    @Override
    protected void onSuccessfullyFinish(UnixMountLocalFolderResult result) {
        if (result.isSharedFolderMounted()) {
            LinuxLocalSharedDrive linuxLocalSharedDrive = (LinuxLocalSharedDrive)this.macLocalSharedDrive;
            LinuxLocalMachineMountFolder mountFolder = new LinuxLocalMachineMountFolder(linuxLocalSharedDrive.getLocalSharedFolderPath(), linuxLocalSharedDrive.getLocalPassword(), result);
            this.callback.onSuccessfullyFinishMountingLocalFolder(mountFolder);
        } else {
            showErrorDialog();
        }
    }

    @Override
    protected UnixMountLocalFolderResult execute() throws Exception {
        LinuxLocalSharedDrive linuxLocalSharedDrive = (LinuxLocalSharedDrive)this.macLocalSharedDrive;
        return CloudExploitationPlatformOp.mountLinuxLocalFolder(linuxLocalSharedDrive.getRemoteSharedFolderPath(), linuxLocalSharedDrive.getRemoteUsername(),
                                                                 linuxLocalSharedDrive.getRemotePassword(), linuxLocalSharedDrive.getLocalSharedFolderPath(),
                                                                 linuxLocalSharedDrive.getLocalPassword());
    }
}
