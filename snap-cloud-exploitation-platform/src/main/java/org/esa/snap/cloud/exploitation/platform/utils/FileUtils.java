package org.esa.snap.cloud.exploitation.platform.utils;

import java.io.IOException;
import java.nio.file.FileVisitResult;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.SimpleFileVisitor;
import java.nio.file.attribute.BasicFileAttributes;
/**
 * Created by jcoravu on 16/1/2019.
 */
public class FileUtils {

    private FileUtils() {
    }

    public static boolean deleteFileTree(Path path) throws IOException {
        Files.walkFileTree(path, new DeleteFileVisitor());
        return !Files.exists(path);
    }

    private static class DeleteFileVisitor extends SimpleFileVisitor<Path> {

        public DeleteFileVisitor() {
        }

        @Override
        public FileVisitResult postVisitDirectory(Path dir, IOException exc) throws IOException {
            Files.delete(dir);
            return FileVisitResult.CONTINUE;
        }

        @Override
        public FileVisitResult preVisitDirectory(Path dir, BasicFileAttributes attrs) throws IOException {
            return FileVisitResult.CONTINUE;
        }

        @Override
        public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) throws IOException {
            Files.delete(file);
            return FileVisitResult.CONTINUE;
        }

        @Override
        public FileVisitResult visitFileFailed(Path file, IOException exc) throws IOException {
            return FileVisitResult.CONTINUE;
        }
    }
}
