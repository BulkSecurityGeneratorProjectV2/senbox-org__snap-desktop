package org.esa.snap.cloud.exploitation.platform;

import com.bc.ceres.binding.ConversionException;
import com.bc.ceres.binding.Converter;
import org.json.simple.JSONArray;
import org.json.simple.JSONObject;
import org.json.simple.parser.JSONParser;
import org.json.simple.parser.ParseException;

import java.util.Date;
import java.util.StringTokenizer;

/**
 * Created by jcoravu on 3/1/2019.
 */
public class ServerCredentialsConverter implements Converter<ServerCredentials[]> {

    public ServerCredentialsConverter() {
    }

    @Override
    public Class<? extends ServerCredentials[]> getValueType() {
        return ServerCredentials[].class;
    }

    @Override
    public ServerCredentials[] parse(String text) throws ConversionException {
        try {
            JSONParser jsonParser = new JSONParser();
            JSONArray jsonArray = (JSONArray)jsonParser.parse(text);
            ServerCredentials[] result = new ServerCredentials[jsonArray.size()];
            for (int i=0; i<jsonArray.size(); i++) {
                JSONObject jsonObject = (JSONObject)jsonArray.get(i);
                String hostName = (String)jsonObject.get("host");
                int portNumber = ((Number)jsonObject.get("port-number")).intValue();
                String operatingSystemName = (String)jsonObject.get("operating-system");
                String username = (String)jsonObject.get("username");
                String password = (String)jsonObject.get("password");
                String sharedFolderPath = (String)jsonObject.get("shared-folder");
                result[i] = new ServerCredentials(hostName, portNumber, username, password, operatingSystemName, sharedFolderPath);
            }
            return result;
        } catch (ParseException e) {
            throw new ConversionException(e);
        }
    }

    @Override
    public String format(ServerCredentials[] value) {
        JSONArray jsonArray = new JSONArray();
        for  (int i=0; i<value.length; i++) {
            JSONObject item = new JSONObject();
            item.put("host", value[i].getHostName());
            item.put("port-number", value[i].getPortNumber());
            item.put("operating-system", value[i].getOperatingSystemName());
            item.put("username", value[i].getUsername());
            item.put("password", value[i].getPassword());
            item.put("shared-folder", value[i].getSharedFolderPath());
            jsonArray.add(item);
        }
        return jsonArray.toString();
    }
}
